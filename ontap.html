<!DOCTYPE html>
<html lang="vi" class="scroll-smooth">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ôn Thi App</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
                extend: {
                    colors: {
                        primary: '#4F46E5', /* Indigo 600 */
                        dark: { bg: '#0f172a', card: '#1e293b', text: '#e2e8f0' }
                    }
                }
            }
        }
    </script>

    <style>
        /* Tùy chỉnh thanh cuộn cho đẹp */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .dark ::-webkit-scrollbar-thumb { background: #334155; }
        
        /* Hiệu ứng ẩn hiện đáp án */
        .blur-answer .correct-mark { display: none; }
        .blur-answer .correct-bg { background-color: transparent !important; border-color: #e2e8f0 !important; }
        .dark .blur-answer .correct-bg { border-color: #334155 !important; }
        .blur-answer .correct-text { color: inherit !important; font-weight: normal !important; }
    </style>
</head>
<body class="bg-gray-50 text-slate-800 dark:bg-dark-bg dark:text-dark-text transition-colors duration-300 antialiased pb-24">

    <header class="fixed top-0 w-full z-40 bg-white/80 dark:bg-dark-bg/80 backdrop-blur-lg border-b border-gray-200 dark:border-slate-800 transition-colors duration-300">
        <div class="max-w-2xl mx-auto px-4 h-16 flex items-center justify-between">
            <h1 class="text-xl font-bold bg-gradient-to-r from-indigo-500 to-cyan-500 bg-clip-text text-transparent">
                ÔN THI
            </h1>

            <div class="flex items-center gap-2">
                <div class="relative hidden sm:block">
                    <input type="number" id="jumpInput" placeholder="Đến câu..." class="w-24 pl-3 pr-2 py-1.5 text-sm rounded-lg border border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-primary transition-colors">
                    <button onclick="jumpToQuestion()" class="absolute right-1 top-1/2 -translate-y-1/2 text-gray-400 hover:text-primary">
                        <i class="fa-solid fa-arrow-right text-xs"></i>
                    </button>
                </div>

                <button onclick="toggleTheme()" class="w-9 h-9 flex items-center justify-center rounded-full bg-gray-100 dark:bg-slate-800 text-gray-600 dark:text-yellow-400 hover:bg-gray-200 dark:hover:bg-slate-700 transition-all">
                    <i class="fa-solid fa-moon dark:hidden"></i>
                    <i class="fa-solid fa-sun hidden dark:inline"></i>
                </button>
            </div>
        </div>
    </header>

    <div class="sm:hidden fixed top-16 w-full bg-white dark:bg-dark-bg border-b border-gray-200 dark:border-slate-800 z-30 px-4 py-2">
        <div class="flex gap-2">
            <input type="number" id="mobileJumpInput" placeholder="Nhập số câu..." class="flex-1 px-3 py-2 rounded-lg bg-gray-100 dark:bg-slate-800 border-none text-sm focus:ring-2 focus:ring-primary">
            <button onclick="jumpToQuestionMobile()" class="px-4 py-2 bg-primary text-white rounded-lg text-sm font-semibold">Đi</button>
        </div>
    </div>

    <main class="max-w-2xl mx-auto px-4 pt-28 sm:pt-24" id="mainContainer">
        
        <div class="flex items-center justify-between mb-6">
            <span id="totalCount" class="text-xs font-bold uppercase tracking-wider text-gray-500 dark:text-slate-400">Loading...</span>
            
            <button id="toggleModeBtn" onclick="toggleStudyMode()" class="flex items-center gap-2 px-3 py-1.5 rounded-full bg-indigo-50 dark:bg-slate-800 text-indigo-600 dark:text-indigo-400 text-xs font-bold border border-indigo-100 dark:border-slate-700 hover:bg-indigo-100 transition-all">
                <i class="fa-solid fa-eye"></i> <span>Xem đáp án</span>
            </button>
        </div>

        <div id="quizList" class="space-y-5">
            <div class="text-center py-10">
                <i class="fa-solid fa-circle-notch fa-spin text-2xl text-primary"></i>
            </div>
        </div>
    </main>

    <button onclick="window.scrollTo({top:0, behavior:'smooth'})" class="fixed bottom-6 right-6 w-12 h-12 bg-primary text-white rounded-full shadow-lg shadow-indigo-500/30 flex items-center justify-center hover:scale-110 active:scale-95 transition-all z-50">
        <i class="fa-solid fa-arrow-up"></i>
    </button>

    <script>
        // --- 1. CONFIG & STATE ---
        const overrides = { 3:"B", 4:"A", 32:"B", 37:"C", 48:"A", 122:"D", 137:"D", 148:"D", 156:"D", 158:"B" };
        let isStudyMode = true; // True = Hiện đáp án, False = Ẩn để thi thử

        // --- 2. THEME LOGIC ---
        function toggleTheme() {
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
        }
        // Auto load theme
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        }

        // --- 3. STUDY MODE LOGIC (UX Feature) ---
        function toggleStudyMode() {
            isStudyMode = !isStudyMode;
            const btn = document.getElementById('toggleModeBtn');
            const list = document.getElementById('quizList');
            
            if (isStudyMode) {
                btn.innerHTML = `<i class="fa-solid fa-eye"></i> <span>Xem đáp án</span>`;
                btn.className = "flex items-center gap-2 px-3 py-1.5 rounded-full bg-indigo-50 dark:bg-slate-800 text-indigo-600 dark:text-indigo-400 text-xs font-bold border border-indigo-100 dark:border-slate-700";
                list.classList.remove('blur-answer');
            } else {
                btn.innerHTML = `<i class="fa-solid fa-eye-slash"></i> <span>Thi thử (Ẩn)</span>`;
                btn.className = "flex items-center gap-2 px-3 py-1.5 rounded-full bg-amber-50 dark:bg-slate-800 text-amber-600 dark:text-amber-400 text-xs font-bold border border-amber-100 dark:border-slate-700";
                list.classList.add('blur-answer');
            }
        }

        // --- 4. DATA LOGIC ---
        fetch("questions.txt")
            .then(res => res.text())
            .then(text => {
                const questions = parseQuestions(text);
                render(questions);
            })
            .catch(err => document.getElementById("quizList").innerHTML = "Lỗi file questions.txt");

        function parseQuestions(text) {
            const blocks = text.trim().split(/\n(?=\d+\.)/).filter(Boolean);
            return blocks.map(block => {
                const lines = block.split("\n").map(l => l.trim());
                const id = parseInt(lines[0]);
                const textQ = lines[1];
                const options = {};
                let correct = "";
                
                lines.slice(2).forEach(line => {
                    const match = line.match(/^(\*?)([A-D])\.\s*(.+)$/);
                    if (!match) return;
                    const [, star, key, value] = match;
                    options[key] = value;
                    if (star) correct = key;
                    if (overrides[id]) correct = overrides[id]; // Apply overrides directly
                });
                return { id, text: textQ, options, correct };
            });
        }

        function render(questions) {
            const container = document.getElementById("quizList");
            container.innerHTML = "";
            document.getElementById("totalCount").innerText = `${questions.length} CÂU HỎI`;

            questions.forEach(q => {
                const card = document.createElement("div");
                // Card Style: Shadow mềm, Border mỏng, Rounded đẹp
                card.className = "group bg-white dark:bg-dark-card rounded-2xl p-5 border border-gray-100 dark:border-slate-700 shadow-sm hover:shadow-md transition-all duration-300 scroll-mt-32";
                card.id = `q-${q.id}`; // ID để nhảy tới

                // Header câu hỏi
                let html = `
                    <div class="flex gap-3 mb-4">
                        <span class="flex-shrink-0 w-8 h-8 flex items-center justify-center rounded-lg bg-gray-100 dark:bg-slate-700 text-gray-600 dark:text-gray-300 font-bold text-sm">
                            ${q.id}
                        </span>
                        <h3 class="text-base font-semibold text-gray-800 dark:text-gray-100 leading-snug pt-1">
                            ${q.text}
                        </h3>
                    </div>
                    <div class="space-y-2.5">
                `;

                // Options
                for (const key in q.options) {
                    const isRight = (key === q.correct);
                    
                    // Style mặc định
                    let baseClass = "relative flex items-center p-3 rounded-xl border border-gray-100 dark:border-slate-700 bg-gray-50/50 dark:bg-slate-800/50 transition-all cursor-pointer select-none";
                    let textClass = "text-sm text-gray-600 dark:text-slate-300 ml-3";
                    let labelClass = "font-bold text-gray-400 dark:text-slate-500 w-5";

                    // Style khi ĐÚNG (Có class correct-bg để JS toggle)
                    if (isRight) {
                        baseClass += " correct-bg bg-emerald-50/80 dark:bg-emerald-900/20 border-emerald-200 dark:border-emerald-800";
                        textClass += " correct-text text-emerald-800 dark:text-emerald-400 font-semibold";
                        labelClass = "correct-text font-bold text-emerald-600 dark:text-emerald-400 w-5";
                    }

                    html += `
                        <div class="${baseClass}" onclick="revealOne(this)">
                            <span class="${labelClass}">${key}</span>
                            <span class="${textClass}">${q.options[key]}</span>
                            ${isRight ? '<i class="correct-mark fa-solid fa-check text-emerald-500 absolute right-4"></i>' : ''}
                        </div>
                    `;
                }

                html += `</div>`;
                card.innerHTML = html;
                container.appendChild(card);
            });
        }

        // --- 5. INTERACTION UTILS ---
        
        // Khi ở chế độ "Thi thử", bấm vào đáp án để hiện màu
        function revealOne(el) {
            if (!isStudyMode && el.classList.contains('correct-bg')) {
                // Tạm thời hiện style đúng cho element này
                el.style.backgroundColor = ""; 
                el.style.borderColor = "";
                el.classList.add('!bg-emerald-50', '!border-emerald-500');
                const text = el.querySelector('span:nth-child(2)');
                if(text) text.classList.add('!text-emerald-800', '!font-bold');
            }
        }

        // Jump Logic
        function jumpToQuestion() {
            const val = document.getElementById('jumpInput').value;
            doJump(val);
        }
        function jumpToQuestionMobile() {
            const val = document.getElementById('mobileJumpInput').value;
            doJump(val);
        }
        function doJump(val) {
            if(!val) return;
            const el = document.getElementById(`q-${val}`);
            if(el) {
                el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                // Highlight hiệu ứng
                el.classList.add('ring-2', 'ring-primary', 'ring-offset-2');
                setTimeout(() => el.classList.remove('ring-2', 'ring-primary', 'ring-offset-2'), 1500);
            } else {
                alert('Không tìm thấy câu ' + val);
            }
        }
    </script>
</body>
</html>
